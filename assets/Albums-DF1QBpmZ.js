import{j as t,N,I as b,r as x,a as w}from"./index-DSWP_m3q.js";import{g as I}from"./gallery-I8imnpWh.js";import{p as h,u as A,c as z,d as P}from"./catalog-BaTOuE_l.js";function C({title:l,preview:a,nbPhotos:d,published:i,onTogglePublished:r,onDelete:u}){const m=Array.isArray(a)&&a.length>0;return t.jsxs(N,{to:`/album?title=${l}`,className:"flex flex-row rounded-2xl  bg-gray-400 outline-primary group",children:[t.jsx("div",{className:"relative bg-gray-350 rounded-l-2xl overflow-clip aspect-square h-24",children:m?t.jsx("img",{src:a[0].path,alt:"",className:"size-full  object-cover",loading:"lazy"}):t.jsx("div",{className:"flex size-full items-center justify-center text-gray-400 text-sm",children:t.jsx(b,{name:"images",size:30,className:" fill-gray-100"})})}),t.jsxs("div",{className:"p-3 relative w-full flex justify-center felx flex-col",children:[t.jsx("h3",{className:"text-md font-medium text-white truncate",children:l}),t.jsx("span",{className:"text-md font-medium text-gray-100",children:d}),i!==void 0&&t.jsxs("div",{className:" flex items-center gap-2",children:[t.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${i?"bg-green-600 text-white":"bg-yellow-600 text-white"}`,children:i?"Publié":"Brouillon"}),r&&t.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded bg-gray-600 text-white hover:bg-gray-500",onClick:c=>{c.preventDefault(),r()},children:i?"Dépublier":"Publier"}),u&&t.jsx("button",{type:"button",className:"text-xs flex items-center opacity-0 duration-200 group-hover:opacity-100 justify-center absolute -right-1 -top-1 size-4 bg-red-600 rounded-full text-white hover:bg-red-500",onClick:c=>{c.preventDefault(),u()},children:t.jsx(b,{name:"x",size:14,className:"relative w-1.5 z-10 fill-white"})})]})]})]})}const D=w,p=I;function E(){const[l,a]=x.useState(D),[d,i]=x.useState(!1),[r,u]=x.useState(""),[m,c]=x.useState(""),g=e=>h(l,p,{albumId:e},{sort:"date-desc",limit:1}),f=e=>h(l,p,{albumId:e}).length,y=async e=>{try{const s=!e.published;a(n=>n.map(o=>o.albumId===e.albumId?{...o,published:s}:o)),await A(e.albumId,{published:s})}catch(s){a(n=>n.map(o=>o.albumId===e.albumId?{...o,published:e.published}:o)),console.error(s)}},v=async e=>{if(e.preventDefault(),!!r.trim())try{i(!0);const s=await z({name:r.trim(),desc:m.trim()||void 0});a(n=>[s.album,...n]),u(""),c("")}catch(s){console.error(s)}finally{i(!1)}},j=async e=>{try{await P(e.albumId),a(s=>s.filter(n=>n.albumId!==e.albumId))}catch(s){console.error(s)}};return t.jsxs("div",{className:"album-list",children:[t.jsxs("div",{className:"head py-2 px-3 border-b-2",children:[t.jsx("h1",{className:"text-3xl text-white font-semibold",children:"Albums"}),t.jsx("span",{className:"nb-album text-md text-gray-100",children:l.length+" album"+(l.length>1?"s":"")})]}),t.jsxs("div",{className:"grid gap-4 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 px-18 py-2",children:[l.map(e=>t.jsx(C,{title:e.name,nbPhotos:f(e.albumId),preview:g(e.albumId),published:e.published,onTogglePublished:()=>y(e),onDelete:()=>j(e)},e.albumId)),t.jsxs("form",{onSubmit:v,className:"flex flex-row rounded-2xl bg-gray-400 h-24 overflow-clip",children:[t.jsx("button",{type:"submit",disabled:d||!r.trim(),className:"relative disabled:bg-gray-350 disabled:pointer-event-none disabled:text-gray-100 bg-green-600 text-green-300 rounded-l-2xl overflow-clip aspect-square h-24 group",children:t.jsx("div",{className:"flex size-full items-center justify-center active:cursor-pointer text-sm",children:t.jsx(b,{name:d||!r.trim()?"folder-plus":"plus",size:30,className:" fill-current active:group-hover:scale-110 duration-200"})})}),t.jsxs("div",{className:"p-3 relative w-full flex justify-center felx flex-col",children:[t.jsx("input",{className:"text-white",value:r,onChange:e=>u(e.target.value),placeholder:"Nom de l'album"}),t.jsx("textarea",{className:" text-white rounded w-full",value:m,onChange:e=>c(e.target.value),placeholder:"Description (optionnel)"})]})]})]})]})}export{E as default};
